<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teclistamab Behandelschema & Markers</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.5.0/dist/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ReferenceLine } = Recharts;

        const TeclistamabDashboard = () => {
            // LocalStorage keys
            const STORAGE_KEY = 'teclistamab_week6_data';
            
            // Load saved data or use defaults
            const loadSavedData = () => {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    return JSON.parse(saved);
                }
                return { bcell: 8, igg: 7, autoab: 40 };
            };

            const [view, setView] = useState('dosing');
            const [week6Data, setWeek6Data] = useState(loadSavedData());
            const [customMode, setCustomMode] = useState(true);

            // Save to localStorage whenever data changes
            useEffect(() => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(week6Data));
            }, [week6Data]);

            // Preset values
            const presets = {
                expected: { bcell: 8, igg: 7, autoab: 40 },
                excellent: { bcell: 5, igg: 6, autoab: 35 },
                concern: { bcell: 80, igg: 4.5, autoab: 75 }
            };

            // Dosing data
            const dosingData = [
                { week: '0', dose: 1, label: 'Test' },
                { week: '1', dose: 4.6, label: 'Step-up 1' },
                { week: '2', dose: 12, label: 'Tussen' },
                { week: '3', dose: 22.9, label: 'Step-up 2' },
                { week: '4', dose: 55, label: 'Vol dosis' },
                { week: '5', dose: 0, label: 'STOP' },
                { week: '6', dose: 0, label: 'STOP' },
                { week: '7', dose: 0, label: 'STOP' },
                { week: '8', dose: 0, label: 'STOP' },
                { week: '9', dose: 55, label: 'Booster' },
                { week: '10', dose: 0 },
                { week: '11', dose: 0 },
                { week: '12', dose: 0 },
                { week: '13', dose: 0 },
            ];

            // B-cell data
            const bcellData = [
                { week: '0', count: 200 },
                { week: '1', count: 180 },
                { week: '2', count: 150 },
                { week: '3', count: 100 },
                { week: '4', count: 50 },
                { week: '5', count: 20 },
                { week: '6', count: customMode ? week6Data.bcell : 8, custom: customMode },
                { week: '7', count: 12 },
                { week: '8', count: 20 },
                { week: '9', count: 30 },
                { week: '10', count: 10 },
                { week: '13', count: 15 },
                { week: '16', count: 40 },
                { week: '20', count: 80 },
                { week: '24', count: 120 },
            ];

            // IgG data
            const iggData = [
                { week: '0', level: 10 },
                { week: '2', level: 9.5 },
                { week: '4', level: 8.5 },
                { week: '6', level: customMode ? week6Data.igg : 7, custom: customMode },
                { week: '9', level: 5.5 },
                { week: '13', level: 5 },
                { week: '16', level: 5.5 },
                { week: '20', level: 6.5 },
                { week: '24', level: 7.5 },
            ];

            // Auto-Ab data
            const autoabData = [
                { week: '0', pct: 100 },
                { week: '2', pct: 85 },
                { week: '4', pct: 60 },
                { week: '6', pct: customMode ? week6Data.autoab : 40, custom: customMode },
                { week: '9', pct: 35 },
                { week: '13', pct: 25 },
                { week: '16', pct: 24 },
                { week: '20', pct: 25 },
                { week: '24', pct: 30 },
            ];

            const evaluateResults = () => {
                const bcellStatus = week6Data.bcell < 10 ? 'excellent' : week6Data.bcell < 50 ? 'goed' : week6Data.bcell < 100 ? 'matig' : 'zorgelijk';
                const iggStatus = week6Data.igg > 5 ? 'veilig' : week6Data.igg > 4 ? 'monitor' : 'laag';
                const autoAbStatus = week6Data.autoab < 50 ? 'excellent' : week6Data.autoab < 70 ? 'goed' : 'onvoldoende';
                return { bcellStatus, iggStatus, autoAbStatus };
            };

            const CustomDot = (props) => {
                const { cx, cy, payload } = props;
                return (
                    <circle 
                        cx={cx} 
                        cy={cy} 
                        r={payload.custom ? 8 : 5} 
                        fill={payload.custom ? "#f59e0b" : props.fill}
                        stroke={payload.custom ? "#ffffff" : props.fill}
                        strokeWidth={payload.custom ? 2 : 0}
                    />
                );
            };

            const buttonStyle = (isActive, color) => ({
                padding: '10px 20px',
                backgroundColor: isActive ? color : '#e5e7eb',
                color: isActive ? 'white' : 'black',
                border: 'none',
                borderRadius: '6px',
                cursor: 'pointer',
                fontWeight: 'bold',
                fontSize: '14px'
            });

            return (
                <div style={{ padding: '20px', maxWidth: '1000px', margin: '0 auto', fontFamily: 'system-ui, -apple-system, sans-serif' }}>
                    <h1 style={{ textAlign: 'center', marginBottom: '10px' }}>
                        Teclistamab Behandelschema & Markers
                    </h1>
                    <p style={{ textAlign: 'center', color: '#6b7280', marginBottom: '30px' }}>
                        💾 Je waarden worden automatisch opgeslagen in je browser
                    </p>

                    {/* Navigation */}
                    <div style={{ display: 'flex', gap: '10px', marginBottom: '30px', justifyContent: 'center', flexWrap: 'wrap' }}>
                        <button onClick={() => setView('dosing')} style={buttonStyle(view === 'dosing', '#2563eb')}>
                            Doseringen
                        </button>
                        <button onClick={() => setView('bcells')} style={buttonStyle(view === 'bcells', '#8b5cf6')}>
                            B-cellen
                        </button>
                        <button onClick={() => setView('igg')} style={buttonStyle(view === 'igg', '#06b6d4')}>
                            IgG
                        </button>
                        <button onClick={() => setView('autoab')} style={buttonStyle(view === 'autoab', '#22c55e')}>
                            Auto-Ab
                        </button>
                    </div>

                    {/* Week 6 Input Section */}
                    <div style={{ 
                        marginBottom: '30px', 
                        padding: '20px', 
                        backgroundColor: '#fef3c7', 
                        borderRadius: '8px',
                        border: '2px solid #f59e0b'
                    }}>
                        <h3 style={{ margin: '0 0 15px 0' }}>📊 Week 6 Resultaten</h3>
                        
                        {/* Presets */}
                        <div style={{ 
                            marginBottom: '15px', 
                            padding: '10px', 
                            backgroundColor: '#f3f4f6', 
                            borderRadius: '6px',
                            display: 'flex',
                            gap: '10px',
                            flexWrap: 'wrap',
                            alignItems: 'center'
                        }}>
                            <span style={{ fontWeight: 'bold', fontSize: '14px' }}>Snel invullen:</span>
                            <button
                                onClick={() => setWeek6Data(presets.expected)}
                                style={{
                                    padding: '6px 12px',
                                    backgroundColor: '#3b82f6',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '4px',
                                    cursor: 'pointer',
                                    fontSize: '13px'
                                }}
                            >
                                Verwacht (B:8, IgG:7, Ab:40%)
                            </button>
                            <button
                                onClick={() => setWeek6Data(presets.excellent)}
                                style={{
                                    padding: '6px 12px',
                                    backgroundColor: '#22c55e',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '4px',
                                    cursor: 'pointer',
                                    fontSize: '13px'
                                }}
                            >
                                Excellent (B:5, IgG:6, Ab:35%)
                            </button>
                            <button
                                onClick={() => setWeek6Data(presets.concern)}
                                style={{
                                    padding: '6px 12px',
                                    backgroundColor: '#ef4444',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '4px',
                                    cursor: 'pointer',
                                    fontSize: '13px'
                                }}
                            >
                                Zorgelijk (B:80, IgG:4.5, Ab:75%)
                            </button>
                        </div>

                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '15px', marginBottom: '15px' }}>
                            <div>
                                <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#8b5cf6' }}>
                                    B-cellen (cellen/μL)
                                </label>
                                <input 
                                    type="number" 
                                    value={week6Data.bcell}
                                    onChange={(e) => setWeek6Data({...week6Data, bcell: Number(e.target.value)})}
                                    style={{
                                        width: '100%',
                                        padding: '8px',
                                        borderRadius: '4px',
                                        border: '2px solid #8b5cf6',
                                        fontSize: '16px',
                                        boxSizing: 'border-box'
                                    }}
                                />
                                <span style={{ fontSize: '12px', color: '#6b7280' }}>Target: &lt;10 = excellent</span>
                            </div>
                            
                            <div>
                                <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#06b6d4' }}>
                                    IgG (g/L)
                                </label>
                                <input 
                                    type="number" 
                                    step="0.1"
                                    value={week6Data.igg}
                                    onChange={(e) => setWeek6Data({...week6Data, igg: Number(e.target.value)})}
                                    style={{
                                        width: '100%',
                                        padding: '8px',
                                        borderRadius: '4px',
                                        border: '2px solid #06b6d4',
                                        fontSize: '16px',
                                        boxSizing: 'border-box'
                                    }}
                                />
                                <span style={{ fontSize: '12px', color: '#6b7280' }}>Target: &gt;5 = veilig</span>
                            </div>
                            
                            <div>
                                <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#22c55e' }}>
                                    Auto-Ab (% van baseline)
                                </label>
                                <input 
                                    type="number" 
                                    value={week6Data.autoab}
                                    onChange={(e) => setWeek6Data({...week6Data, autoab: Number(e.target.value)})}
                                    style={{
                                        width: '100%',
                                        padding: '8px',
                                        borderRadius: '4px',
                                        border: '2px solid #22c55e',
                                        fontSize: '16px',
                                        boxSizing: 'border-box'
                                    }}
                                />
                                <span style={{ fontSize: '12px', color: '#6b7280' }}>Target: &lt;50% = goed</span>
                            </div>
                        </div>

                        {/* Evaluation */}
                        <div style={{ 
                            padding: '15px', 
                            backgroundColor: 'white', 
                            borderRadius: '6px',
                            border: '2px solid #e5e7eb'
                        }}>
                            <h4 style={{ margin: '0 0 10px 0' }}>📋 Evaluatie:</h4>
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '10px' }}>
                                {/* B-cell evaluation */}
                                <div style={{ 
                                    padding: '10px', 
                                    backgroundColor: 
                                        evaluateResults().bcellStatus === 'excellent' ? '#dcfce7' : 
                                        evaluateResults().bcellStatus === 'goed' ? '#fef3c7' : 
                                        evaluateResults().bcellStatus === 'matig' ? '#fed7aa' : '#fecaca',
                                    borderRadius: '4px',
                                    border: '1px solid #e5e7eb'
                                }}>
                                    <strong>B-cellen:</strong> {evaluateResults().bcellStatus}
                                    <br/>
                                    <span style={{ fontSize: '12px' }}>
                                        {week6Data.bcell < 10 ? '✓ Diepe depletie - perfect!' : 
                                         week6Data.bcell < 50 ? '○ Acceptabel niveau' : 
                                         week6Data.bcell < 100 ? '⚠ Matige depletie' : '✗ Te weinig effect'}
                                    </span>
                                </div>
                                
                                {/* IgG evaluation */}
                                <div style={{ 
                                    padding: '10px', 
                                    backgroundColor: 
                                        evaluateResults().iggStatus === 'veilig' ? '#dcfce7' : 
                                        evaluateResults().iggStatus === 'monitor' ? '#fef3c7' : '#fecaca',
                                    borderRadius: '4px',
                                    border: '1px solid #e5e7eb'
                                }}>
                                    <strong>IgG:</strong> {evaluateResults().iggStatus}
                                    <br/>
                                    <span style={{ fontSize: '12px' }}>
                                        {week6Data.igg > 5 ? '✓ Veilig niveau' : 
                                         week6Data.igg > 4 ? '⚠ Monitoren, IVIG standby' : '✗ Laag! IVIG overwegen'}
                                    </span>
                                </div>
                                
                                {/* Auto-Ab evaluation */}
                                <div style={{ 
                                    padding: '10px', 
                                    backgroundColor: 
                                        evaluateResults().autoAbStatus === 'excellent' ? '#dcfce7' : 
                                        evaluateResults().autoAbStatus === 'goed' ? '#fef3c7' : '#fecaca',
                                    borderRadius: '4px',
                                    border: '1px solid #e5e7eb'
                                }}>
                                    <strong>Auto-Ab:</strong> {evaluateResults().autoAbStatus}
                                    <br/>
                                    <span style={{ fontSize: '12px' }}>
                                        {week6Data.autoab < 50 ? `✓ ${100-week6Data.autoab}% reductie!` : 
                                         week6Data.autoab < 70 ? `○ ${100-week6Data.autoab}% reductie` : '⚠ Onvoldoende'}
                                    </span>
                                </div>
                            </div>

                            {/* Overall conclusion */}
                            <div style={{ 
                                marginTop: '15px', 
                                padding: '12px', 
                                backgroundColor: 
                                    (evaluateResults().bcellStatus === 'excellent' && 
                                     evaluateResults().iggStatus === 'veilig' && 
                                     evaluateResults().autoAbStatus === 'excellent') ? '#dcfce7' :
                                    (evaluateResults().bcellStatus === 'zorgelijk' || 
                                     evaluateResults().iggStatus === 'laag' || 
                                     evaluateResults().autoAbStatus === 'onvoldoende') ? '#fecaca' : '#fef3c7',
                                borderRadius: '6px',
                                border: '2px solid',
                                borderColor:
                                    (evaluateResults().bcellStatus === 'excellent' && 
                                     evaluateResults().iggStatus === 'veilig' && 
                                     evaluateResults().autoAbStatus === 'excellent') ? '#22c55e' :
                                    (evaluateResults().bcellStatus === 'zorgelijk' || 
                                     evaluateResults().iggStatus === 'laag' || 
                                     evaluateResults().autoAbStatus === 'onvoldoende') ? '#ef4444' : '#f59e0b'
                            }}>
                                <strong>Overall:</strong>
                                {(evaluateResults().bcellStatus === 'excellent' && 
                                  evaluateResults().iggStatus === 'veilig' && 
                                  evaluateResults().autoAbStatus === 'excellent') ? 
                                  ' 🎉 Uitstekend! Dosis adequaat. Ga door met booster.' :
                                 (evaluateResults().bcellStatus === 'zorgelijk' || 
                                  evaluateResults().autoAbStatus === 'onvoldoende') ?
                                  ' ⚠️ Mogelijk onvoldoende. Overweeg hogere booster (75mg).' :
                                 evaluateResults().iggStatus === 'laag' ?
                                  ' ⚠️ IgG te laag. Booster uitstellen, IVIG overwegen.' :
                                  ' ✓ Redelijk. Ga door met booster, monitor nauwkeurig.'}
                            </div>
                        </div>
                    </div>

                    {/* Charts */}
                    {view === 'dosing' && (
                        <div>
                            <h2>Dosering Schema (mg)</h2>
                            <ResponsiveContainer width="100%" height={400}>
                                <BarChart data={dosingData} margin={{ top: 20, right: 30, left: 20, bottom: 20 }}>
                                    <CartesianGrid strokeDasharray="3 3" />
                                    <XAxis dataKey="week" label={{ value: 'Weken', position: 'insideBottom', offset: -10 }} />
                                    <YAxis label={{ value: 'Dosis (mg)', angle: -90, position: 'insideLeft' }} />
                                    <Tooltip />
                                    <Bar dataKey="dose" fill="#3b82f6" />
                                </BarChart>
                            </ResponsiveContainer>
                            <div style={{ marginTop: '20px', padding: '15px', backgroundColor: '#f3f4f6', borderRadius: '8px' }}>
                                <p><strong>Week 0-4:</strong> Opbouw 1 → 4.6 → 12 → 22.9 → 55mg</p>
                                <p><strong>Week 5-8:</strong> 4 weken STOP</p>
                                <p><strong>Week 9:</strong> Booster 55mg, dan klaar</p>
                                <p><strong>Totaal:</strong> 150.5mg</p>
                            </div>
                        </div>
                    )}

                    {view === 'bcells' && (
                        <div>
                            <h2>B-cel Counts (CD19+)</h2>
                            <ResponsiveContainer width="100%" height={400}>
                                <LineChart data={bcellData} margin={{ top: 20, right: 30, left: 20, bottom: 20 }}>
                                    <CartesianGrid strokeDasharray="3 3" />
                                    <XAxis dataKey="week" label={{ value: 'Weken', position: 'insideBottom', offset: -10 }} />
                                    <YAxis label={{ value: 'Cellen/μL', angle: -90, position: 'insideLeft' }} />
                                    <Tooltip />
                                    <Line type="monotone" dataKey="count" stroke="#8b5cf6" strokeWidth={3} dot={<CustomDot fill="#8b5cf6" />} />
                                    <ReferenceLine y={10} stroke="#22c55e" strokeDasharray="5 5" label="Target <10" />
                                    <ReferenceLine y={50} stroke="#f59e0b" strokeDasharray="5 5" label="Week 13: <50" />
                                </LineChart>
                            </ResponsiveContainer>
                            <div style={{ marginTop: '20px', padding: '15px', backgroundColor: '#f0fdf4', borderRadius: '8px', border: '2px solid #86efac' }}>
                                <p><strong>✓ Week 6:</strong> &lt;10 = diepe depletie (goed)</p>
                                <p><strong>✓ Week 13:</strong> &lt;50 = nog gedepleteerd (adequaat)</p>
                                <p><strong>✓ Week 24:</strong> Geleidelijk herstel (langzaam = goed)</p>
                            </div>
                        </div>
                    )}

                    {view === 'igg' && (
                        <div>
                            <h2>IgG Spiegels (g/L)</h2>
                            <ResponsiveContainer width="100%" height={400}>
                                <LineChart data={iggData} margin={{ top: 20, right: 30, left: 20, bottom: 20 }}>
                                    <CartesianGrid strokeDasharray="3 3" />
                                    <XAxis dataKey="week" label={{ value: 'Weken', position: 'insideBottom', offset: -10 }} />
                                    <YAxis domain={[0, 12]} label={{ value: 'IgG (g/L)', angle: -90, position: 'insideLeft' }} />
                                    <Tooltip />
                                    <Line type="monotone" dataKey="level" stroke="#06b6d4" strokeWidth={3} dot={<CustomDot fill="#06b6d4" />} />
                                    <ReferenceLine y={4} stroke="#ef4444" strokeDasharray="5 5" label="Kritiek <4" />
                                    <ReferenceLine y={5} stroke="#f59e0b" strokeDasharray="5 5" label="Laag <5" />
                                </LineChart>
                            </ResponsiveContainer>
                            <div style={{ marginTop: '20px', padding: '15px', backgroundColor: '#ecfeff', borderRadius: '8px', border: '2px solid #67e8f9' }}>
                                <p><strong>✓ Week 6:</strong> ~7 g/L = veilig</p>
                                <p><strong>✓ Week 13:</strong> ~5 g/L = laagste punt, nog boven kritiek</p>
                                <p><strong>⚠️ Actie:</strong> IVIG alleen als &lt;4 g/L + infecties</p>
                            </div>
                        </div>
                    )}

                    {view === 'autoab' && (
                        <div>
                            <h2>Auto-antilichamen (% van baseline)</h2>
                            <ResponsiveContainer width="100%" height={400}>
                                <LineChart data={autoabData} margin={{ top: 20, right: 30, left: 20, bottom: 20 }}>
                                    <CartesianGrid strokeDasharray="3 3" />
                                    <XAxis dataKey="week" label={{ value: 'Weken', position: 'insideBottom', offset: -10 }} />
                                    <YAxis domain={[0, 110]} label={{ value: '% van baseline', angle: -90, position: 'insideLeft' }} />
                                    <Tooltip />
                                    <Line type="monotone" dataKey="pct" stroke="#22c55e" strokeWidth={3} dot={<CustomDot fill="#22c55e" />} />
                                    <ReferenceLine y={50} stroke="#22c55e" strokeDasharray="5 5" label="Target <50%" />
                                    <ReferenceLine y={70} stroke="#f59e0b" strokeDasharray="5 5" label="Week 6 <70%" />
                                </LineChart>
                            </ResponsiveContainer>
                            <div style={{ marginTop: '20px', padding: '15px', backgroundColor: '#f0fdf4', borderRadius: '8px', border: '2px solid #86efac' }}>
                                <p><strong>🎯 Week 6:</strong> 40% (-60% reductie) = goed</p>
                                <p><strong>🎯 Week 13:</strong> 25% (-75% reductie) = excellent</p>
                                <p><strong>🎯 Week 24:</strong> Blijft laag = duurzaam succes</p>
                            </div>
                        </div>
                    )}

                    {/* Footer */}
                    <div style={{ marginTop: '40px', padding: '15px', backgroundColor: '#f3f4f6', borderRadius: '8px', fontSize: '14px', color: '#6b7280' }}>
                        <p style={{ margin: '5px 0' }}>💾 <strong>Data opslag:</strong> Je waarden worden automatisch opgeslagen in localStorage van deze browser.</p>
                        <p style={{ margin: '5px 0' }}>🔒 <strong>Privacy:</strong> Alle data blijft lokaal op jouw apparaat, niets wordt naar een server gestuurd.</p>
                        <p style={{ margin: '5px 0' }}>🌐 <strong>GitHub Pages:</strong> Perfect voor hosting - bewaar deze pagina via GitHub Pages.</p>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<TeclistamabDashboard />, document.getElementById('root'));
    </script>
</body>
</html>